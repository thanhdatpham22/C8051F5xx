C51 COMPILER V9.54   TIMER                                                                 04/18/2025 16:51:38 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN timer.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.exe timer.c DB OE BR INCDIR(c:\SiLabs\MCU_4\Inc)

line level    source

   1          
   2          #include <compiler_defs.h>
   3          #include <C8051F580_defs.h> 
   4          #include "uart.h"
*** WARNING C323 IN LINE 16 OF uart.h: newline expected, extra characters found
   5          
   6          #define TIMOUT_BYTE 4
   7          #define SYSCLK 24000000
   8          
   9          volatile unsigned long timeout_counter = 0;
  10          volatile unsigned long last_timeout_counter = 0;
  11          
  12          extern U8 UART1_Buffer_Size;
  13          extern bit UART1_Received_Full;
  14          //----------------------------Timer0----------------------------
  15          void Timer0_Init(void)
  16          {
  17   1              
  18   1              TMOD &= 0xF0;
  19   1              TMOD |= 0x01; // timer 16bit
  20   1              CKCON |= 0x02;  // SYSCLK/48 = 500 kHz
  21   1              TH0 = (65536 - 500) >> 8;
  22   1              TL0 = (655536 -500) & 0xFF;
  23   1          ET0 = 1;               
  24   1          TR0 = 1;               
  25   1      }
  26          
  27          INTERRUPT(Timer0_ISR, INTERRUPT_TIMER0)
  28          {       
  29   1              TH0 = (65536 - 500) >> 8;
  30   1          TL0 = (65536 - 500) & 0xFF;
  31   1      
  32   1          timeout_counter++;
  33   1              /*if ((timeout_counter - last_timeout_counter) >= TIMOUT_BYTE) // 
  34   1          {
  35   1              if (UART1_Buffer_Size > 0 && UART1_Buffer_Size < UART1_BUFFERSIZE)
  36   1              {
  37   1                  UART1_Received_Full = 2;
  38   1              }
  39   1          }*/
  40   1      }
  41          
  42          void delay_ms(unsigned int ms)
  43          {
  44   1          unsigned long start = timeout_counter;
  45   1          while ((timeout_counter - start) < ms);
  46   1      }
  47          
  48          
  49          //----------------------------Timer2----------------------------
  50          void TIMER2_Init (void)
  51          {
  52   1         // CKCON is available on all pages
  53   1         CKCON    |= 0x10;
  54   1      }
C51 COMPILER V9.54   TIMER                                                                 04/18/2025 16:51:38 PAGE 2   

  55          void Delay_us (U8 time_us)
  56          {
  57   1         U8 SFRPAGE_save = SFRPAGE;
  58   1         SFRPAGE = ACTIVE_PAGE;
  59   1      
  60   1         TR2   = 0;                          // Stop timer
  61   1         TF2H  = 0;                          // Clear timer overflow flag
  62   1         TMR2  = -((U16)(SYSCLK / 1000000) * (U16)(time_us));
  63   1         TR2   = 1;                          // Start timer
  64   1         while (!TF2H);                      // Wait till timer overflow occurs
  65   1         TR2   = 0;                          // Stop timer
  66   1      
  67   1         SFRPAGE = SFRPAGE_save;
  68   1      }
  69          
  70          void Delay_t2_ms (U8 time_ms)
  71          {
  72   1         U8 i;
  73   1      
  74   1         while(time_ms--) 
  75   1         {
  76   2            for(i = 0; i< 10; i++)           // 10 * 100 microsecond delay
  77   2            {         
  78   3               Delay_us (100); 
  79   3            }
  80   2         }
  81   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    199    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
