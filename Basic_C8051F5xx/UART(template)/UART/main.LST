C51 COMPILER V9.54   MAIN                                                                  04/25/2025 13:22:52 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.exe main.c DB OE BR INCDIR(C:\SiLabs\MCU_4\Inc)

line level    source

   1          
   2          //-----------------------------------------------------------------------------
   3          // Includes
   4          //-----------------------------------------------------------------------------
   5          
   6          #include <compiler_defs.h>
   7          #include <C8051F580_defs.h>            // SFR declarations
   8          #include <stdio.h>
   9          
  10          //-----------------------------------------------------------------------------
  11          // Global CONSTANTS
  12          //-----------------------------------------------------------------------------
  13          
  14          #define SYSCLK      24000000           // SYSCLK frequency in Hz
  15          #define BAUDRATE      115200            // Baud rate of UART in bps
  16          #define UART1_BUFFERSIZE 64
  17          
  18          SBIT (LEDY, SFR_P2, 0);                 
  19          SBIT (LEDG, SFR_P2, 1);
  20          SBIT (SW2, SFR_P1, 1);
  21          
  22          volatile unsigned long timeout_counter = 0;
  23          
  24          U8 UART1_Buffer[UART1_BUFFERSIZE];
  25          
  26          U8 UART1_Buffer_Size = 0;
  27          bit UART1_Received_Full = 0; 
  28          static U8 Byte;
  29          //--------------spi_d
  30          
  31          //-----------------------------------------------------------------------------
  32          // Function PROTOTYPES
  33          //-----------------------------------------------------------------------------
  34          
  35          void SYSCLK_Init (void);
  36          void UART1_Init (void);
  37          void PORT_Init (void);
  38          void delay_ms(unsigned int ms);
  39          void Timer0_Init(void);
  40          
  41          
  42          //-----------------------------------------------------------------------------
  43          // MAIN Routine
  44          //-----------------------------------------------------------------------------
  45          
  46          void main (void)
  47          {
  48   1              U8 i;
  49   1      
  50   1         SFRPAGE = ACTIVE_PAGE;
  51   1      
  52   1         PCA0MD &= ~0x40;                    // Disable watchdog timer
  53   1         PORT_Init();                        // Initialize Port I/O
  54   1         SYSCLK_Init ();                     
  55   1         UART1_Init();
C51 COMPILER V9.54   MAIN                                                                  04/25/2025 13:22:52 PAGE 2   

  56   1         Timer0_Init();
  57   1         EA =1;
  58   1         SFRPAGE = ACTIVE2_PAGE;             // Switch page for UART1 communication
  59   1      
  60   1         while (1)
  61   1         {    
  62   2              for(i = 0 ; i < UART1_BUFFERSIZE; i++)
  63   2                      {
  64   3                              printf("%c", UART1_Buffer[i]);
  65   3                      }
  66   2                      printf("\r\n");
  67   2                      delay_ms(1000);
  68   2         }
  69   1         
  70   1      }
  71          
  72          
  73          //-----------------------------------------------------------------------------
  74          // PORT_Init
  75          //-----------------------------------------------------------------------------
  76          
  77          void PORT_Init (void)
  78          {
  79   1         U8 SFRPAGE_save = SFRPAGE;
  80   1         SFRPAGE = CONFIG_PAGE;
  81   1      
  82   1          P1MDOUT |= 0x08;                    // Enable UART1 TX as push-pull output
  83   1          P0SKIP  = 0xFF;                     // Skip to P0, and P1.1,2,3
  84   1              P1SKIP = 0xE7;                                          // Enable UART1 on P1.3(TX) and P1.4(RX)
  85   1      
  86   1              P2MDOUT |= 0x03;                    // Enable LED as a push-pull output
  87   1          P2SKIP  |= 0xFC;
  88   1              //XBR0      = 0x04;
  89   1          XBR2    = 0x40;                     
  90   1                                             // Enable crossbar and weak pull-ups
  91   1          SFRPAGE = SFRPAGE_save;
  92   1      }
  93          
  94          //-----------------------------------------------------------------------------
  95          // SYSCLK_Init
  96          //-----------------------------------------------------------------------------
  97          
  98          void SYSCLK_Init (void)
  99          {
 100   1         U8 SFRPAGE_save = SFRPAGE;
 101   1         SFRPAGE = CONFIG_PAGE;
 102   1      
 103   1         OSCICN |= 0x87;                     // Configure internal oscillator for
 104   1                                             // its maximum frequency
 105   1         RSTSRC  = 0x04;                     // Enable missing clock detector
 106   1      
 107   1         SFRPAGE = SFRPAGE_save;
 108   1      }
 109          void Timer0_Init(void)
 110          {
 111   1              
 112   1              TMOD &= 0xF0;
 113   1              TMOD |= 0x01; // timer 16bit
 114   1              CKCON |= 0x02;  // SYSCLK/48 = 500 kHz
 115   1              TH0 = (65536 - 500) >> 8;
 116   1              TL0 = (655536 -500) & 0xFF;
 117   1          ET0 = 1;               
C51 COMPILER V9.54   MAIN                                                                  04/25/2025 13:22:52 PAGE 3   

 118   1          TR0 = 1;               
 119   1      }
 120          
 121          INTERRUPT(Timer0_ISR, INTERRUPT_TIMER0)
 122          {       
 123   1              TH0 = (65536 - 500) >> 8;
 124   1          TL0 = (65536 - 500) & 0xFF;
 125   1      
 126   1          timeout_counter++;
 127   1      }
 128          //-----------------------------------------------------------------------------
 129          // UART1_Init
 130          //-----------------------------------------------------------------------------
 131          
 132          void UART1_Init (void)
 133          {
 134   1         U8 SFRPAGE_save = SFRPAGE;
 135   1         SFRPAGE = ACTIVE2_PAGE;
 136   1      
 137   1         SCON1 = 0x10;                       // SCON1: 8-bit variable bit rate
 138   1      
 139   1         if (SYSCLK / BAUDRATE / 2 / 256 < 1) 
 140   1         {
 141   2            TH1 = -(SYSCLK / BAUDRATE / 2);
 142   2            CKCON &= ~0x0B;                  // T1M = 1; SCA1:0 = xx
 143   2            CKCON |=  0x08;
 144   2         } 
 145   1         else if (SYSCLK / BAUDRATE / 2 / 256 < 4) 
 146   1         {
 147   2            TH1 = -(SYSCLK / BAUDRATE / 2 / 4);
 148   2            CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 01
 149   2            CKCON |=  0x01;
 150   2         } 
 151   1         else if (SYSCLK / BAUDRATE / 2 / 256 < 12) 
 152   1         {
 153   2            TH1 = -(SYSCLK / BAUDRATE / 2 / 12);
 154   2            CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 00
 155   2         } 
 156   1         else 
 157   1         {
 158   2            TH1 = -(SYSCLK / BAUDRATE / 2 / 48);
 159   2            CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 10
 160   2            CKCON |=  0x02;
 161   2         }
 162   1      
 163   1          TL1 = TH1;                          // Init Timer1
 164   1          TMOD &= ~0xF0;                      // TMOD: timer 1 in 8-bit autoreload
 165   1          TMOD |=  0x20;
 166   1          TR1 = 1;                            // START Timer1
 167   1      
 168   1          TI1 = 1;                            // Indicate TX0 ready (SCON1)
 169   1              EIE2 |= 0x08;
 170   1          SFRPAGE = SFRPAGE_save;
 171   1      }
 172          
 173          INTERRUPT(UART1_ISR, INTERRUPT_UART1)
 174          { 
 175   1              U8 SFRPAGE_save = SFRPAGE;
 176   1          SFRPAGE = ACTIVE2_PAGE;
 177   1              if (RI1 == 1)
 178   1          {
 179   2                  Byte = SBUF1;                    
C51 COMPILER V9.54   MAIN                                                                  04/25/2025 13:22:52 PAGE 4   

 180   2                  if (UART1_Buffer_Size < UART1_BUFFERSIZE)
 181   2                  {
 182   3                     UART1_Buffer[UART1_Buffer_Size] = Byte; // Store in array
 183   3                     UART1_Buffer_Size++;     
 184   3                         //last_timeout_counter = timeout_counter;    // Update array's size                   
 185   3                  }
 186   2      
 187   2                      else
 188   2                      {
 189   3                              UART1_Buffer_Size =0;
 190   3                      }
 191   2      
 192   2                      RI1 = 0;  
 193   2                           
 194   2          }
 195   1              SFRPAGE = SFRPAGE_save;
 196   1      }
 197          
 198          
 199          
 200          void delay_ms(unsigned int ms)
 201          {
 202   1          unsigned long start = timeout_counter;
 203   1          while ((timeout_counter - start) < ms);
 204   1      }
 205          
 206          
 207          //-----------------------------------------------------------------------------
 208          // End Of File
 209          //-----------------------------------------------------------------------------
*** WARNING C294 IN LINE 147 OF main.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    336    ----
   CONSTANT SIZE    =      6    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     70       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
